<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Satƒ±≈ü Raporu</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 40px; }
      .kpis { display: flex; gap: 18px; flex-wrap: wrap; margin-bottom: 18px; }
      .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; min-width: 160px; }
      table { border-collapse: collapse; width: 100%; margin: 14px 0; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background: #f5f5f5; }
      img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 10px; padding: 8px; }
      .small { color: #666; font-size: 12px; }
      a { text-decoration: none; }
    </style>
  </head>
  <body>

    <a href="/">&larr; Yeni analiz</a>

    <h1>Satƒ±≈ü Raporu</h1>

    <!-- SQLite ekleri -->
    <p>
      <a href="/history">üìÅ Ge√ßmi≈ü Raporlar</a>
    </p>

    {% if meta %}
      <p class="small">
        Rapor No: {{ meta.id }} ‚Äî
        Olu≈üturulma: {{ meta.created_at }} ‚Äî
        Dosya: {{ meta.original_filename }}
      </p>
    {% endif %}

    <!-- KPI'lar -->
    <div class="kpis">
      <div class="card">
        <b>Toplam Ciro</b><br/>
        {{ "%.2f"|format(kpi.total_revenue) }}
      </div>
      <div class="card">
        <b>Toplam Sipari≈ü</b><br/>
        {{ kpi.total_orders }}
      </div>
      <div class="card">
        <b>Toplam √úr√ºn Adedi</b><br/>
        {{ kpi.total_items }}
      </div>
      <div class="card">
        <b>Ortalama Sipari≈ü Tutarƒ±</b><br/>
        {{ "%.2f"|format(kpi.aov) }}
      </div>
    </div>

    <!-- Grafik -->
    <h2>G√ºnl√ºk Ciro Grafiƒüi</h2>
    <p class="small">Grafik sistem tarafƒ±ndan otomatik olu≈üturulmu≈ütur.</p>
    <img src="/static/{{ chart_file }}" alt="G√ºnl√ºk ciro grafiƒüi" />

    <!-- En √ßok satan √ºr√ºnler -->
    <h2>En √áok Satan √úr√ºnler (ƒ∞lk 10)</h2>
    <table>
      <thead>
        <tr>
          <th>√úr√ºn</th>
          <th>Ciro</th>
          <th>Satƒ±lan Adet</th>
          <th>Sipari≈ü Sayƒ±sƒ±</th>
        </tr>
      </thead>
      <tbody>
        {% for r in top_products %}
          <tr>
            <td>{{ r.product }}</td>
            <td>{{ "%.2f"|format(r.revenue) }}</td>
            <td>{{ r.units }}</td>
            <td>{{ r.orders }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- G√ºnl√ºk √∂zet -->
    <h2>G√ºnl√ºk Satƒ±≈ü √ñzeti (Son 14 G√ºn)</h2>
    <table>
      <thead>
        <tr>
          <th>Tarih</th>
          <th>Ciro</th>
          <th>Sipari≈ü</th>
          <th>√úr√ºn Adedi</th>
        </tr>
      </thead>
      <tbody>
        {% for r in daily %}
          <tr>
            <td>{{ r.day }}</td>
            <td>{{ "%.2f"|format(r.revenue) }}</td>
            <td>{{ r.orders }}</td>
            <td>{{ r.units }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- √ñn izleme (varsa) -->
    {% if preview and preview|length > 0 %}
      <h2>Veri √ñn ƒ∞zleme (Son 30 Satƒ±r)</h2>
      <table>
        <thead>
          <tr>
            <th>Tarih</th>
            <th>Sipari≈ü No</th>
            <th>√úr√ºn</th>
            <th>Adet</th>
            <th>Birim Fiyat</th>
            <th>Satƒ±r Cirosu</th>
          </tr>
        </thead>
        <tbody>
          {% for r in preview %}
            <tr>
              <td>{{ r.date }}</td>
              <td>{{ r.order_id }}</td>
              <td>{{ r.product }}</td>
              <td>{{ r.quantity }}</td>
              <td>{{ r.unit_price }}</td>
              <td>{{ "%.2f"|format(r.revenue) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}

  </body>
</html>
